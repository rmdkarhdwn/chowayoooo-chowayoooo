<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bot Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #2c3e50;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #FFD700;
        }
        .stat-label {
            font-size: 14px;
            margin-top: 5px;
            opacity: 0.8;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: #FFD700;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #FFC700;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        .player-list {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
        }
        .player-item {
            padding: 5px;
            margin: 3px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– ë´‡ í…ŒìŠ¤íŠ¸ & ì„œë²„ ëª¨ë‹ˆí„°ë§</h1>
        
        <!-- ì‹¤ì‹œê°„ í†µê³„ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalPlayers">0</div>
                <div class="stat-label">ì´ ì ‘ì†ì</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="botCount">0</div>
                <div class="stat-label">ë´‡ ìˆ˜</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="scoreCount">0</div>
                <div class="stat-label">ì ìˆ˜ ê¸°ë¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="zoneTimer">-</div>
                <div class="stat-label">êµ¬ì—­ ë‚¨ì€ ì‹œê°„</div>
            </div>
        </div>

        <!-- ë²„íŠ¼ -->
        <div>
            <button onclick="createBots(10)" id="btn10">10ëª… ìƒì„±</button>
            <button onclick="createBots(50)" id="btn50">50ëª… ìƒì„±</button>
            <button onclick="createBots(100)" id="btn100">100ëª… ìƒì„±</button>
            <button onclick="clearBots()" id="btnClear">ëª¨ë‘ ì‚­ì œ</button>
        </div>

        <!-- ìƒíƒœ ë¡œê·¸ -->
        <div id="status"></div>

        <!-- í”Œë ˆì´ì–´ ëª©ë¡ -->
        <div class="player-list">
            <h3>ğŸ“‹ ì ‘ì†ì ëª©ë¡</h3>
            <div id="playerList"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, set, onDisconnect, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDtqPDt8Ix_yOJ50oqCMWyYy89G5RjvQYg",
            authDomain: "neleujimaseyo.firebaseapp.com",
            databaseURL: "https://neleujimaseyo-default-rtdb.firebaseio.com", // âœ… ì´ê±° ìˆì–´?
            projectId: "neleujimaseyo",
            storageBucket: "neleujimaseyo.firebasestorage.app",
            messagingSenderId: "982487378024",
            appId: "1:982487378024:web:55773e4fae04784e45f3dd",
            measurementId: "G-0DRRZXHH6V"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        const botIds = [];
        const botIntervals = [];

        // ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
        function startMonitoring() {
            // í”Œë ˆì´ì–´ ìˆ˜ ëª¨ë‹ˆí„°ë§
            const playersRef = ref(database, 'players');
            onValue(playersRef, (snapshot) => {
                const players = snapshot.val();
                const count = players ? Object.keys(players).length : 0;
                document.getElementById('totalPlayers').textContent = count;

                // í”Œë ˆì´ì–´ ëª©ë¡ í‘œì‹œ
                const playerListDiv = document.getElementById('playerList');
                if (players) {
                    playerListDiv.innerHTML = Object.entries(players)
                        .map(([id, data]) => `
                            <div class="player-item">
                                ${id.substring(0, 8)}... | 
                                ìœ„ì¹˜: (${Math.floor(data.x)}, ${Math.floor(data.y)})
                            </div>
                        `).join('');
                } else {
                    playerListDiv.innerHTML = '<div style="opacity: 0.5;">ì ‘ì†ì ì—†ìŒ</div>';
                }
            });

            // ì ìˆ˜ ìˆ˜ ëª¨ë‹ˆí„°ë§
            const scoresRef = ref(database, 'scores');
            onValue(scoresRef, (snapshot) => {
                const scores = snapshot.val();
                const count = scores ? Object.keys(scores).length : 0;
                document.getElementById('scoreCount').textContent = count;
            });

            // êµ¬ì—­ íƒ€ì´ë¨¸ ëª¨ë‹ˆí„°ë§
            const zoneRef = ref(database, 'zone');
            onValue(zoneRef, (snapshot) => {
                const zone = snapshot.val();
                if (zone) {
                    setInterval(() => {
                        const elapsed = (Date.now() - zone.createdAt) / 1000;
                        const remaining = Math.max(0, zone.duration - elapsed);
                        document.getElementById('zoneTimer').textContent = 
                            remaining.toFixed(1) + 's';
                    }, 100);
                }
            });

            // ë´‡ ìˆ˜ ì—…ë°ì´íŠ¸
            setInterval(() => {
                document.getElementById('botCount').textContent = botIds.length;
            }, 1000);
        }

        function log(message) {
            const statusDiv = document.getElementById('status');
            const time = new Date().toLocaleTimeString();
            statusDiv.innerHTML = `[${time}] ${message}<br>` + statusDiv.innerHTML;
        }

        function disableButtons(disabled) {
            document.getElementById('btn10').disabled = disabled;
            document.getElementById('btn50').disabled = disabled;
            document.getElementById('btn100').disabled = disabled;
        }

        window.createBots = async function(count) {
            disableButtons(true);
            log(`ğŸ¤– ${count}ëª… ë´‡ ìƒì„± ì‹œì‘...`);
            
            for (let i = 0; i < count; i++) {
                try {
                    // âœ… ë¡œê·¸ì•„ì›ƒ í›„ ìƒˆë¡œ ë¡œê·¸ì¸
                    await auth.signOut();
                    
                    const user = await signInAnonymously(auth);
                    const userId = user.user.uid;
                    
                    console.log(`Bot ${i+1} ìƒì„±:`, userId);
                    
                    botIds.push(userId);
                    
                    let x = Math.random() * 4500 + 250;
                    let y = Math.random() * 4500 + 250;
                    
                    const playerRef = ref(database, `players/${userId}`);
                    await set(playerRef, { 
                        x: x, 
                        y: y, 
                        lastUpdate: Date.now() 
                    });
                    
                    onDisconnect(playerRef).remove();
                    
                    // ë´‡ ëœë¤ ì›€ì§ì„
                    const moveInterval = setInterval(() => {
                        x += (Math.random() - 0.5) * 50;
                        y += (Math.random() - 0.5) * 50;
                        x = Math.max(100, Math.min(4900, x));
                        y = Math.max(100, Math.min(4900, y));
                        
                        set(playerRef, {
                            x: x,
                            y: y,
                            lastUpdate: Date.now()
                        });
                    }, 3000);
                    
                    botIntervals.push(moveInterval);
                    
                    if ((i + 1) % 10 === 0) {
                        log(`âœ… ${i + 1}/${count} ìƒì„± ì™„ë£Œ`);
                    }
                } catch (error) {
                    console.error('ì—ëŸ¬:', error);
                    log(`âŒ Bot ${i+1} ì‹¤íŒ¨: ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            log(`ğŸ‰ ì´ ${count}ëª… ìƒì„± ì™„ë£Œ!`);
            disableButtons(false);
        };

        window.clearBots = async function() {
            disableButtons(true);
            log('ğŸ—‘ï¸ ëª¨ë“  ë´‡ ì‚­ì œ ì¤‘...');
            
            // ì›€ì§ì„ íƒ€ì´ë¨¸ ì •ë¦¬
            botIntervals.forEach(interval => clearInterval(interval));
            botIntervals.length = 0;
            
            // Firebaseì—ì„œ ì‚­ì œ
            for (const userId of botIds) {
                const playerRef = ref(database, `players/${userId}`);
                await remove(playerRef);
            }
            
            botIds.length = 0;
            log('âœ… ëª¨ë“  ë´‡ ì‚­ì œ ì™„ë£Œ');
            disableButtons(false);
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë‹ˆí„°ë§ ì‹œì‘
        startMonitoring();
        log('âœ… ëª¨ë‹ˆí„°ë§ ì‹œì‘');
    </script>
</body>
</html>